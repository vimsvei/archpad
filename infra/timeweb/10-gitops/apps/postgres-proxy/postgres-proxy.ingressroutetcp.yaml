apiVersion: traefik.io/v1alpha1
kind: IngressRouteTCP
metadata:
  name: postgres
  namespace: platform
  annotations:
    argocd.argoproj.io/sync-wave: "75"
spec:
  entryPoints:
    - db
  routes:
    # PostgreSQL starts as plain TCP and upgrades to TLS after SSLRequest,
    # so we can't rely on HostSNI(db.archpad.pro). We route all traffic on :9432.
    - match: HostSNI(`*`)
      services:
        - name: postgres-proxy
          port: 5432
